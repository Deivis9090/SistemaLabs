CREATE TABLE campus (
  ID_CAMPUS int NOT NULL AUTO_INCREMENT,
  NOMBRE varchar(50) NOT NULL,
  PRIMARY KEY (ID_CAMPUS)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE edificio (
  ID_EDIFICIO int NOT NULL AUTO_INCREMENT,
  ID_CAMPUS int NOT NULL,
  Nombre_Edificio varchar(30), 
  PRIMARY KEY (ID_EDIFICIO),
  KEY ID_CAMPUS (ID_CAMPUS),
  CONSTRAINT edificio_ibfk_1 FOREIGN KEY (ID_CAMPUS) REFERENCES campus (ID_CAMPUS)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE equipo (
  ID_EQUIPO int NOT NULL AUTO_INCREMENT,
  ID_LABORATORIO int NOT NULL,
  DISPONIBILIDAD tinyint(1) NOT NULL,
  PRIMARY KEY (ID_EQUIPO),
  KEY ID_LABORATORIO (ID_LABORATORIO),
  CONSTRAINT equipo_ibfk_1 FOREIGN KEY (ID_LABORATORIO) REFERENCES laboratorio (ID_LABORATORIO)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE horario (
  ID_HORARIO int NOT NULL AUTO_INCREMENT,
  HORA_INI time NOT NULL,
  HORA_FIN time NOT NULL,
  PRIMARY KEY (ID_HORARIO),
  CONSTRAINT chk_hora_fin CHECK (((hour(HORA_FIN) between 8 and 22) and (dayofweek(HORA_FIN) between 2 and 6))),
  CONSTRAINT chk_hora_ini CHECK (((hour(HORA_INI) between 8 and 22) and (dayofweek(HORA_INI) between 2 and 6)))
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE laboratorio (
  ID_LABORATORIO int NOT NULL AUTO_INCREMENT,
  ID_EDIFICIO int NOT NULL,
  ID_CAMPUS int NOT NULL,
  ID_HORARIO int NOT NULL,
  NO_EQUIPO int NOT NULL,
  DISPONIBILIDAD tinyint(1) NOT NULL,
  PRIMARY KEY (ID_LABORATORIO),
  KEY ID_EDIFICIO (ID_EDIFICIO),
  KEY ID_CAMPUS (ID_CAMPUS),
  KEY ID_HORARIO (ID_HORARIO),
  CONSTRAINT laboratorio_ibfk_1 FOREIGN KEY (ID_EDIFICIO) REFERENCES edificio (ID_EDIFICIO),
  CONSTRAINT laboratorio_ibfk_2 FOREIGN KEY (ID_CAMPUS) REFERENCES campus (ID_CAMPUS),
  CONSTRAINT laboratorio_ibfk_3 FOREIGN KEY (ID_HORARIO) REFERENCES horario (ID_HORARIO)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE reserva (
  ID_RESE int NOT NULL AUTO_INCREMENT,
  ID_USUARIO int NOT NULL,
  ID_EQUIPO int NOT NULL,
  FECHA_INI date NOT NULL,
  FECHA_FIN date NOT NULL,
  ESTADO tinyint(1) NOT NULL,
  PRIMARY KEY (ID_RESE),
  KEY ID_USUARIO (ID_USUARIO),
  KEY ID_EQUIPO (ID_EQUIPO),
  CONSTRAINT reserva_ibfk_1 FOREIGN KEY (ID_USUARIO) REFERENCES usuario (ID_USUARIO),
  CONSTRAINT reserva_ibfk_2 FOREIGN KEY (ID_EQUIPO) REFERENCES equipo (ID_EQUIPO)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE tipo_usuario (
  ID_TIPO_USUARIO int NOT NULL,
  NOMBRE varchar(20) NOT NULL,
  TIPO_USUARIO int NOT NULL,
  PRIMARY KEY (ID_TIPO_USUARIO)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE usuario (
  ID_USUARIO int NOT NULL,
  ID_TIPO_USUARIO int NOT NULL,
  NOMBRE varchar(10) NOT NULL,
  CONTRASENA varchar(10) NOT NULL,
  PRIMARY KEY (ID_USUARIO),
  KEY ID_TIPO_USUARIO (ID_TIPO_USUARIO),
  CONSTRAINT usuario_ibfk_1 FOREIGN KEY (ID_TIPO_USUARIO) REFERENCES tipo_usuario (ID_TIPO_USUARIO)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;